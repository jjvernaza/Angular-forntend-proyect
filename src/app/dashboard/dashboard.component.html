<div class="p-6">
  <h1 class="text-4xl font-bold mb-4">Dashboard de VozIpCompany</h1>
  <h2 class="text-2xl font-semibold mb-6">Estadísticas generales</h2>
  
  <!-- Tarjetas de resumen -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
    <!-- Tarjeta de Total Clientes -->
    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
      <h3 class="text-lg font-medium text-gray-700">Total Clientes</h3>
      <p class="text-3xl font-bold">
        {{ dashboardStats?.clientes?.total || 0 }}
      </p>
    </div>
    
    <!-- Tarjeta de Clientes Activos -->
    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
      <h3 class="text-lg font-medium text-gray-700">Clientes Activos</h3>
      <p class="text-3xl font-bold">
        {{ dashboardStats?.clientes?.activos || 0 }}
      </p>
    </div>
    
    <!-- Tarjeta de Clientes Suspendidos -->
    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500">
      <h3 class="text-lg font-medium text-gray-700">Clientes Suspendidos</h3>
      <p class="text-3xl font-bold">
        {{ dashboardStats?.clientes?.suspendidos || 0 }}
      </p>
    </div>
    
    <!-- Tarjeta de Ingresos Mes Actual -->
    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-purple-500">
      <h3 class="text-lg font-medium text-gray-700">Ingresos Mes Actual</h3>
      <p class="text-3xl font-bold">
        {{ formatCurrency(dashboardStats?.pagos?.mesActual || 0) }}
      </p>
    </div>
  </div>
  
  <!-- Selector de Año -->
  <div class="bg-white rounded-lg shadow p-4 mb-6">
    <h3 class="text-lg font-medium text-gray-700 mb-2">Seleccionar Año</h3>
    <div class="flex space-x-2">
      <button 
        *ngFor="let year of availableYears" 
        (click)="changeYear(year)"
        [class]="selectedYear === year ? 
          'bg-blue-500 text-white px-4 py-2 rounded' : 
          'bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300'"
      >
        {{ year }}
      </button>
    </div>
  </div>
  
  <!-- Gráficos en grid de 2x2 -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Gráfico de Clientes -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-lg font-medium text-gray-700 mb-2">Distribución de Clientes</h3>
      <div class="chart-container">
        <canvas id="clientChartCanvas"></canvas>
      </div>
    </div>
    
    <!-- Gráfico de Ingresos -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-lg font-medium text-gray-700 mb-2">Ingresos Mensuales {{ selectedYear }}</h3>
      <div class="chart-container">
        <canvas id="incomeChartCanvas"></canvas>
      </div>
    </div>
    
    <!-- Gráfico de Tipos de Servicio -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-lg font-medium text-gray-700 mb-2">Tipos de Servicio</h3>
      <div class="chart-container">
        <canvas id="serviceChartCanvas"></canvas>
      </div>
    </div>
    
    <!-- Gráfico de Sectores -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="text-lg font-medium text-gray-700 mb-2">Distribución por Sector</h3>
      <div class="chart-container">
        <canvas id="sectorChartCanvas"></canvas>
      </div>
    </div>
  </div>

  <!-- Tabla de datos -->
  <div class="bg-white rounded-lg shadow p-4 mb-8">
    <h3 class="text-2xl font-semibold mb-4">Tabla de Ingresos Mensuales {{ selectedYear }}</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border border-gray-200">
        <thead class="bg-gray-100">
          <tr>
            <th class="border border-gray-300 px-4 py-2 text-left">Mes</th>
            <th class="border border-gray-300 px-4 py-2 text-left">Año</th>
            <th class="border border-gray-300 px-4 py-2 text-right">Ingresos</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="monthlyIncomeData.length > 0; else noData">
            <tr *ngFor="let item of monthlyIncomeData">
              <td class="border border-gray-300 px-4 py-2">{{ item.mes }}</td>
              <td class="border border-gray-300 px-4 py-2">{{ item.anio }}</td>
              <td class="border border-gray-300 px-4 py-2 text-right">{{ formatCurrency(item.total) }}</td>
            </tr>
          </ng-container>
          <ng-template #noData>
            <tr>
              <td colspan="3" class="border border-gray-300 px-4 py-2 text-center">
                No hay datos disponibles
              </td>
            </tr>
          </ng-template>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Botones para descargar datos -->
  <div class="flex flex-col sm:flex-row gap-4 mt-4">
    <!-- Botón para descargar datos de ingresos -->
    <button 
      (click)="downloadData()" 
      class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
      Descargar Ingresos (CSV)
    </button>

    <!-- Botón para descargar listado de clientes en Excel -->
    <button 
      (click)="downloadClientsExcel()" 
      class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd" />
      </svg>
      Descargar Clientes (Excel)
    </button>
  </div>
</div>